<html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Custom Block Components · Draft.js</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="Custom Block Components · Draft.js"/><meta property="og:type" content="website"/><meta property="og:url" content="https://draftjs.org/draft-js/index.html"/><meta property="og:description" content="Draft is designed to solve problems for straightforward rich text interfaces"/><link rel="shortcut icon" href="/draft-js/undefined"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atelier-forest-light.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/draft-js/css/main.css"/></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/draft-js/"><h2 class="headerTitle">Draft.js</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li><a href="/draft-js/docs/getting-started.html" target="_self">Docs</a></li><li><a href="https://github.com/facebook/draft-js" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Advanced Topics</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Quick Start</h3><ul><li class="navListItem"><a class="navItem" href="/draft-js/docs/getting-started.html">Overview</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/quickstart-api-basics.html">API Basics</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/quickstart-rich-styling.html">Rich Styling</a></li></ul></div><div class="navGroup navGroupActive"><h3>Advanced Topics</h3><ul><li class="navListItem"><a class="navItem" href="/draft-js/docs/advanced-topics-entities.html">Entities</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/v0-10-api-migration.html">v0.10 API Migration</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/advanced-topics-decorators.html">Decorators</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/advanced-topics-key-bindings.html">Key Bindings</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/advanced-topics-managing-focus.html">Managing Focus</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/advanced-topics-block-styling.html">Block Styling</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/advanced-topics-custom-block-render-map.html">Custom Block Rendering</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/draft-js/docs/advanced-topics-block-components.html">Custom Block Components</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/advanced-topics-inline-styles.html">Complex Inline Styles</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/advanced-topics-nested-lists.html">Nested Lists</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/advanced-topics-text-direction.html">Text Direction</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/advanced-topics-editorstate-race-conditions.html">EditorState Race Conditions</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/advanced-topics-issues-and-pitfalls.html">Issues and Pitfalls</a></li></ul></div><div class="navGroup navGroupActive"><h3>API Reference</h3><ul><li class="navListItem"><a class="navItem" href="/draft-js/docs/api-reference-editor.html">Editor Component</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/api-reference-editor-change-type.html">EditorChangeType</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/api-reference-editor-state.html">EditorState</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/api-reference-content-state.html">ContentState</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/api-reference-content-block.html">ContentBlock</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/api-reference-character-metadata.html">CharacterMetadata</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/api-reference-entity.html">Entity</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/api-reference-selection-state.html">SelectionState</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/api-reference-composite-decorator.html">CompositeDecorator</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/api-reference-data-conversion.html">Data Conversion</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/api-reference-rich-utils.html">RichUtils</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/api-reference-atomic-block-utils.html">AtomicBlockUtils</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/api-reference-key-binding-util.html">KeyBindingUtil</a></li><li class="navListItem"><a class="navItem" href="/draft-js/docs/api-reference-modifier.html">Modifier</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>Custom Block Components</h1></header><article><div><span><p>Draft is designed to solve problems for straightforward rich text interfaces
like comments and chat messages, but it also powers richer editor experiences
like <a href="https://www.facebook.com/notes/">Facebook Notes</a>.</p>
<p>Users can embed images within their Notes, either loading from their existing
Facebook photos or by uploading new images from the desktop. To that end,
the Draft framework supports custom rendering at the block level, to render
content like rich media in place of plain text.</p>
<p>The <a href="https://github.com/facebook/draft-js/tree/master/examples/draft-0-10-0/tex">TeX editor</a>
in the Draft repository provides a live example of custom block rendering, with
TeX syntax translated on the fly into editable embedded formula rendering via the
<a href="https://khan.github.io/KaTeX/">KaTeX library</a>.</p>
<p>A <a href="https://github.com/facebook/draft-js/tree/master/examples/draft-0-10-0/media">media example</a> is also
available, which showcases custom block rendering of audio, image, and video.</p>
<p>By using a custom block renderer, it is possible to introduce complex rich
interactions within the frame of your editor.</p>
<h2><a class="anchor" aria-hidden="true" name="custom-block-components"></a><a href="#custom-block-components" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Custom Block Components</h2>
<p>Within the <code>Editor</code> component, one may specify the <code>blockRendererFn</code> prop.
This prop function allows a higher-level component to define custom React
rendering for <code>ContentBlock</code> objects, based on block type, text, or other
criteria.</p>
<p>For instance, we may wish to render <code>ContentBlock</code> objects of type <code>'atomic'</code>
using a custom <code>MediaComponent</code>.</p>
<pre><code class="hljs css js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">myBlockRenderer</span>(<span class="hljs-params">contentBlock</span>) </span>{
  <span class="hljs-keyword">const</span> type = contentBlock.getType();
  <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'atomic'</span>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">component</span>: MediaComponent,
      <span class="hljs-attr">editable</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-attr">props</span>: {
        <span class="hljs-attr">foo</span>: <span class="hljs-string">'bar'</span>,
      },
    };
  }
}

<span class="hljs-comment">// Then...</span>
<span class="hljs-keyword">import</span> {Editor} <span class="hljs-keyword">from</span> <span class="hljs-string">'draft-js'</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EditorWithMedia</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
  ...
  render() {
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Editor</span> <span class="hljs-attr">...</span> <span class="hljs-attr">blockRendererFn</span>=<span class="hljs-string">{myBlockRenderer}</span> /&gt;</span>;
  }
}
</span></code></pre>
<p>If no custom renderer object is returned by the <code>blockRendererFn</code> function,
<code>Editor</code> will render the default <code>DraftEditorBlock</code> text block component.</p>
<p>The <code>component</code> property defines the component to be used, while the optional
<code>props</code> object includes props that will be passed through to the rendered
custom component via the <code>props.blockProps</code> sub property object. In addition,
the optional <code>editable</code> property determines whether the custom component is
<code>contentEditable</code>.</p>
<p>It is strongly recommended that you use <code>editable: false</code> if your custom
component will not contain text.</p>
<p>If your component contains text as provided by your <code>ContentState</code>, your custom
component should compose a <code>DraftEditorBlock</code> component. This will allow the
Draft framework to properly maintain cursor behavior within your contents.</p>
<p>By defining this function within the context of a higher-level component,
the props for this custom component may be bound to that component, allowing
instance methods for custom component props.</p>
<h2><a class="anchor" aria-hidden="true" name="defining-custom-block-components"></a><a href="#defining-custom-block-components" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Defining custom block components</h2>
<p>Within <code>MediaComponent</code>, the most likely use case is that you will want to
retrieve entity metadata to render your custom block. You may apply an entity
key to the text within a <code>'atomic'</code> block during <code>EditorState</code> management,
then retrieve the metadata for that key in your custom component <code>render()</code>
code.</p>
<pre><code class="hljs css js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MediaComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
  render() {
    <span class="hljs-keyword">const</span> {block, contentState} = <span class="hljs-keyword">this</span>.props;
    <span class="hljs-keyword">const</span> {foo} = <span class="hljs-keyword">this</span>.props.blockProps;
    <span class="hljs-keyword">const</span> data = contentState.getEntity(block.getEntityAt(<span class="hljs-number">0</span>)).getData();
    <span class="hljs-comment">// Return a &lt;figure&gt; or some other content using this data.</span>
  }
}
</code></pre>
<p>The <code>ContentBlock</code> object and the <code>ContentState</code> record are made available
within the custom component, along with the props defined at the top level. By
extracting entity information from the <code>ContentBlock</code> and the <code>Entity</code> map, you
can obtain the metadata required to render your custom component.</p>
<p><em>Retrieving the entity from the block is admittedly a bit of an awkward API,
and is worth revisiting.</em></p>
<h2><a class="anchor" aria-hidden="true" name="recommendations-and-other-notes"></a><a href="#recommendations-and-other-notes" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Recommendations and other notes</h2>
<p>If your custom block renderer requires mouse interaction, it is often wise
to temporarily set your <code>Editor</code> to <code>readOnly={true}</code> during this
interaction. In this way, the user does not trigger any selection changes within
the editor while interacting with the custom block. This should not be a problem
with respect to editor behavior, since interacting with your custom block
component is most likely mutually exclusive from text changes within the editor.</p>
<p>The recommendation above is especially important for custom block renderers
that involve text input, like the TeX editor example.</p>
<p>It is also worth noting that within the Facebook Notes editor, we have not
tried to perform any special SelectionState rendering or management on embedded
media, such as rendering a highlight on an embedded photo when selecting it.
This is in part because of the rich interaction provided on the media
itself, with resize handles and other controls exposed to mouse behavior.</p>
<p>Since an engineer using Draft has full awareness of the selection state
of the editor and full control over native Selection APIs, it would be possible
to build selection behavior on static embedded media if desired. So far, though,
we have not tried to solve this at Facebook, so we have not packaged solutions
for this use case into the Draft project at this time.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="advanced-topics-custom-block-render-map.html">← Custom Block Rendering</a><a class="docs-next button" href="advanced-topics-inline-styles.html">Complex Inline Styles →</a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><div><h5>Docs</h5><a href="/draft-js/docs/en/getting-started.html">Getting Started</a><a href="/draft-js/docs/en/api-reference-editor.html">API Reference</a></div><div><h5>Community</h5><a href="http://stackoverflow.com/questions/tagged/draftjs" target="_blank">Stack Overflow</a><a href="https://twitter.com/draft_js" target="_blank">Twitter</a></div><div><h5>More</h5><a href="https://github.com/facebook/draft-js">GitHub</a><a class="github-button" href="https://github.com/facebook/draft-js" data-icon="octicon-star" data-count-href="/aadsm/draft-js/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" class="fbOpenSource"><img src="/draft-js/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2018 Facebook Inc.</section></footer></div></body></html>